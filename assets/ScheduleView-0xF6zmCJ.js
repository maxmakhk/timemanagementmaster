import{_ as le,u as ie,r as $,f as ne,h as oe,c,a as t,b as C,n as P,t as l,F as j,i as A,j as M,k as N,e as ce,o as u,l as w,m as ue,p as re}from"./index-mYd7Dziu.js";import{a as de}from"./activities-C17TaqRo.js";const ve={class:"schedule-view"},he={class:"graphic-placeholder"},ge=["src"],me={class:"schedule-header-bar"},_e={class:"header-title"},fe={class:"header-subtitle"},pe={key:0,class:"header-info"},ye={class:"deadline"},De={class:"schedule-container"},Ce={class:"left-panels"},ke={class:"npc-panel"},be={class:"panel-header"},Se={key:0,class:"empty-state"},Ne={key:1,class:"npc-cards-list"},we=["onClick"],$e={key:0,class:"pass-badge"},Oe={class:"npc-header"},Pe={class:"npc-image"},je={class:"npc-title"},Ae={class:"npc-description"},Ee={class:"npc-goals"},Me={class:"goal-row"},qe={class:"goal-name"},Le={class:"goal-progress"},Je={class:"current-bar"},Te={class:"goal-values"},Be={class:"goal-row"},Ke={class:"goal-name"},Qe={class:"goal-progress"},Re={class:"current-bar"},Ve={class:"goal-values"},Fe={class:"goal-row"},Ue={class:"goal-name"},ze={class:"goal-progress"},Ge={class:"current-bar"},He={class:"goal-values"},We={class:"npc-status"},Xe={class:"status-item"},Ye={class:"status-item"},Ze={class:"npc-reward"},Ie={class:"cards-panel"},xe={class:"cards-hint"},es={class:"cards-list"},ss=["onDragstart","onClick"],ts={class:"card-name"},as={class:"card-effect"},ls={key:1},is={key:2},ns={key:0,class:"card-cost"},os={key:0},cs={key:1},us={class:"timetable-panel"},rs={class:"timetable-header-info"},ds={class:"timetable-subtitle"},vs={class:"timetable"},hs={class:"timetable-header"},gs={key:0,class:"day-status"},ms={key:1,class:"day-status"},_s=["onDrop","onDragover","onClick"],fs=["onClick","title"],ps={class:"action-buttons"},ys={__name:"ScheduleView",setup(Ds){const L=ce(),{t:O}=ie(),J="/timemanagementmaster/",r=$([]),S=$(r.value.length>0?r.value[0].id:null),T=$(0),k=M({}),_=M({}),q=$([]),f=M({}),z=N(()=>{if(!v.value)return[];const o=f[v.value.id]||v.value.requiredDays||5,e=o+1;return Array.from({length:e},(a,i)=>{const n=i+1;return n===o+1?`ðŸ“ Exam Day ${n}`:`Day ${n}`})}),B=["08:00","10:00","12:00","14:00","16:00","18:00"],G=N(()=>de.map(s=>({...s,name:O(`schedule.${s.activityKey}`)}))),p=M({}),h=M({}),b=N(()=>{if(!v.value)return[];const o=f[v.value.id]||v.value.requiredDays||5;return p[S.value]||Array.from({length:o+1},()=>Array(6).fill(null))}),v=N(()=>r.value.find(s=>s.id===S.value)),g=N(()=>v.value&&(f[v.value.id]||v.value.requiredDays)||5),d=N(()=>v.value&&k[v.value.id]||0),H=N(()=>{if(!v.value)return J+"images/time-management/Alice_rest.png";const s=["codingClass","mathStudy","fitnessTraining","lunch","rest"],o=v.value.name,e=s[Math.floor(Math.random()*s.length)];return J+`images/time-management/${o}_${e}.png`}),W=N(()=>{const s=["bg_codingClass.jpg","bg_mathStudy.jpg","bg_fitnessTraining.jpg","bg_lunch.jpg","bg_rest.jpg"],o=s[Math.floor(Math.random()*s.length)];return J+`images/time-management/${o}`}),E=$(null),y=$(null),K=$(!1),X=s=>{E.value=s},Y=s=>{y.value?.id===s.id?y.value=null:y.value=s},Z=s=>{S.value=s.id},Q=(s,o,e=!1)=>{if(!v.value){alert(O("schedule.selectNPCFirst")),E.value=null;return}if(s<d.value){alert(O("schedule.pastDaysNoEdit")),E.value=null;return}const a=E.value||y.value;if(a){if(e){const i=b.value.length;for(let n=s;n<i;n++){const m={...a,instanceId:Date.now()+n};b.value[n][o]=m}}else{const i={...a,instanceId:Date.now()};b.value[s][o]=i}E.value=null}},I=(s,o,e)=>{if(y.value){const a=e?.shiftKey||!1;if(a&&e.preventDefault(),Q(s,o,a),a){const i=b.value.length-s;console.log(O("schedule.appliedToMultipleDays",{card:y.value.name,count:i,timeSlot:B[o]}))}}},x=(s,o)=>{if(s<d.value){alert(O("schedule.pastDaysNoEdit"));return}b.value[s][o]=null},ee=s=>{s.preventDefault()},R=s=>{s.key==="Shift"&&(K.value=!0)},V=s=>{s.key==="Shift"&&(K.value=!1)};ne(()=>{window.addEventListener("keydown",R),window.addEventListener("keyup",V);const s=sessionStorage.getItem("newNPC");if(s){const i=JSON.parse(s);sessionStorage.removeItem("newNPC");const n=sessionStorage.getItem("scheduleState");if(n){const D=JSON.parse(n);r.value=D.selectedNPCs||[],Object.assign(p,D.npcSchedules||{}),Object.assign(h,D.npcCurrentAbilities||{}),Object.assign(k,D.npcCurrentDays||{}),Object.assign(_,D.npcPassStatus||{}),q.value=D.completedQuestIds||[],D.extendedDays&&Object.assign(f,D.extendedDays)}r.value.push(i);const m=(i.requiredDays||5)+1;p[i.id]=Array.from({length:m},()=>Array(6).fill(null)),h[i.id]={coding:i.initial.coding,math:i.initial.math,fitness:i.initial.fitness,mood:50,energy:50},k[i.id]=0,_[i.id]=!1,S.value=i.id;return}const o=sessionStorage.getItem("scheduleState");if(o){const i=JSON.parse(o);r.value=i.selectedNPCs||[],Object.assign(p,i.npcSchedules||{}),Object.assign(h,i.npcCurrentAbilities||{}),Object.assign(k,i.npcCurrentDays||{}),Object.assign(_,i.npcPassStatus||{}),q.value=i.completedQuestIds||[],i.extendedDays&&Object.assign(f,i.extendedDays),r.value.length>0&&!S.value&&(S.value=r.value[0].id);return}const e=sessionStorage.getItem("selectedNPCs");if(e){r.value=JSON.parse(e),r.value.length>0&&(S.value=r.value[0].id);const i=Math.max(...r.value.map(n=>n.requiredDays||5));r.value.forEach(n=>{p[n.id]=Array.from({length:i},()=>Array(6).fill(null)),h[n.id]={coding:n.initial.coding,math:n.initial.math,fitness:n.initial.fitness,mood:50,energy:50},k[n.id]=0,_[n.id]=!1});return}const a=sessionStorage.getItem("simulationData");if(a){const i=JSON.parse(a);T.value=i.currentDay||0,Object.assign(p,i.npcSchedules),Object.assign(h,i.npcCurrentAbilities),i.npcCurrentDays&&Object.assign(k,i.npcCurrentDays),i.npcPassStatus&&Object.assign(_,i.npcPassStatus),i.extendedDays&&(Object.assign(f,i.extendedDays),r.value.forEach(n=>{const m=i.extendedDays[n.id];if(m&&p[n.id]){const D=m+1,F=p[n.id].length;if(F<D)for(let U=F;U<D;U++)p[n.id].push(Array(6).fill(null))}}))}}),oe(()=>{window.removeEventListener("keydown",R),window.removeEventListener("keyup",V)});const se=()=>{if(r.value.length===0){alert(O("schedule.selectAtLeastOneNPC"));return}const s={selectedNPCs:r.value,npcSchedules:p,npcCurrentAbilities:h,npcCurrentDays:k,npcPassStatus:_,completedQuestIds:q.value,extendedDays:Object.keys(f).length>0?f:void 0};sessionStorage.setItem("scheduleState",JSON.stringify(s));const o={selectedNPCs:r.value.map(e=>({id:e.id,name:e.name,image:e.image,goals:e.goals,initial:e.initial,requiredDays:e.requiredDays})),npcSchedules:p,npcCurrentAbilities:h,npcCurrentDays:k,npcPassStatus:_,currentDay:T.value,extendedDays:Object.keys(f).length>0?f:void 0};sessionStorage.setItem("simulationData",JSON.stringify(o)),L.push("/time-management/simulation")},te=()=>{L.push("/")},ae=()=>{const s={selectedNPCs:r.value,npcSchedules:p,npcCurrentAbilities:h,npcCurrentDays:k,npcPassStatus:_,completedQuestIds:q.value,extendedDays:Object.keys(f).length>0?f:void 0};sessionStorage.setItem("scheduleState",JSON.stringify(s)),L.push("/time-management/intake")};return(s,o)=>(u(),c("div",ve,[t("button",{onClick:te,class:"home-button"},"ðŸ "),t("div",{class:"schedule-graphic-area",style:P({backgroundImage:`url(${W.value})`})},[t("div",he,[v.value?(u(),c("img",{key:0,src:H.value,class:"random-character",alt:"Character"},null,8,ge)):C("",!0)])],4),t("div",me,[t("div",_e,[t("strong",null,l(s.$t("schedule.title")),1),t("span",fe,l(s.$t("schedule.subtitle")),1)]),v.value?(u(),c("div",pe,[t("span",null,l(v.value.name)+" - "+l(s.$t(v.value.characterKey)),1),t("span",ye,l(s.$t("schedule.deadline"))+": "+l(s.$t("schedule.day"))+" "+l(g.value)+" | "+l(s.$t("schedule.progress"))+": "+l(s.$t("schedule.day"))+" "+l(T.value+1),1)])):C("",!0)]),t("div",De,[t("div",Ce,[t("div",ke,[t("div",be,[t("h2",null,"ðŸ“‹ "+l(s.$t("schedule.npcMissions")),1),t("button",{onClick:ae,class:"btn-add-mission"}," âž• Add NPC Mission ")]),r.value.length===0?(u(),c("div",Se,[...o[0]||(o[0]=[t("p",null,"No missions yet!",-1),t("p",null,'Click "Add NPC Mission" to start',-1)])])):(u(),c("div",Ne,[(u(!0),c(j,null,A(r.value,e=>(u(),c("div",{key:e.id,class:w(["npc-mission-card",{active:S.value===e.id,passed:_[e.id]}]),onClick:a=>!_[e.id]&&Z(e)},[_[e.id]?(u(),c("div",$e,"âœ… PASSED")):C("",!0),t("div",Oe,[t("span",Pe,l(e.image),1),t("div",je,[t("h3",null,l(e.name),1),t("span",{class:w(["difficulty","difficulty-"+e.difficulty.toLowerCase()])},l(e.difficulty),3)])]),t("p",Ae,l(s.$t(e.descriptionKey)),1),t("div",Ee,[t("div",Me,[t("span",qe,l(s.$t("schedule.coding")),1),t("div",Le,[t("span",Je,[t("span",{class:"current-fill",style:P({width:h[e.id].coding/e.goals.coding*100+"%"})},null,4)]),t("span",Te,l(h[e.id].coding)+" / "+l(e.goals.coding),1)])]),t("div",Be,[t("span",Ke,l(s.$t("schedule.math")),1),t("div",Qe,[t("span",Re,[t("span",{class:"current-fill",style:P({width:h[e.id].math/e.goals.math*100+"%"})},null,4)]),t("span",Ve,l(h[e.id].math)+" / "+l(e.goals.math),1)])]),t("div",Fe,[t("span",Ue,l(s.$t("schedule.fitness")),1),t("div",ze,[t("span",Ge,[t("span",{class:"current-fill",style:P({width:h[e.id].fitness/e.goals.fitness*100+"%"})},null,4)]),t("span",He,l(h[e.id].fitness)+" / "+l(e.goals.fitness),1)])])]),t("div",We,[t("span",Xe,"âš¡ ç²¾åŠ›: "+l(h[e.id].energy)+"/100",1),t("span",Ye,"ðŸ˜Š å¿ƒæƒ…: "+l(h[e.id].mood)+"/100",1)]),t("div",Ze," ðŸ’° +"+l(e.rewards.masterReputation)+" "+l(s.$t("schedule.reputation")),1)],10,we))),128))]))]),t("div",Ie,[t("p",xe,l(y.value?`${y.value.name} | ${s.$t("schedule.clickToAdd")} | ${s.$t("schedule.shiftClickApplyAll")}`:s.$t("schedule.clickSelectOrDrag")),1),t("div",es,[(u(!0),c(j,null,A(G.value,e=>(u(),c("div",{key:e.id,class:w(["card",{selected:y.value?.id===e.id}]),style:P({backgroundColor:e.color,opacity:y.value?.id===e.id?1:.8}),draggable:"true",onDragstart:a=>X(e),onClick:a=>Y(e)},[t("div",ts,l(e.name),1),t("div",as,[s.key!=="energy"&&s.key!=="mood"?(u(!0),c(j,{key:0},A(e.effect,(a,i)=>(u(),c("span",{key:i},l(i)+": +"+l(a),1))),128)):C("",!0),e.effect.energy&&!e.isRest?(u(),c("span",ls,"ðŸ’¾ èƒ½é‡+"+l(e.effect.energy),1)):C("",!0),e.effect.mood&&!e.isRest?(u(),c("span",is,"ðŸ˜Š å¿ƒæƒ…+"+l(e.effect.mood),1)):C("",!0)]),e.cost?(u(),c("div",ns,[e.cost.energy?(u(),c("span",os,"âš¡ -"+l(e.cost.energy),1)):C("",!0),e.cost.mood?(u(),c("span",cs,"ðŸ˜Š -"+l(e.cost.mood),1)):C("",!0)])):C("",!0)],46,ss))),128))])])]),t("div",us,[t("div",rs,[t("h2",null,l(s.$t("schedule.fiveDaySchedule"))+" - "+l(v.value?.name),1),t("p",ds,l(v.value?.description),1)]),t("div",vs,[t("div",hs,[o[1]||(o[1]=t("div",{class:"day-col"},null,-1)),(u(),c(j,null,A(B,(e,a)=>t("div",{key:a,class:"time-col"},l(e),1)),64))]),(u(!0),c(j,null,A(z.value,(e,a)=>(u(),c("div",{key:e,class:w(["timetable-row",{"past-day-row":a<d.value,"today-row":a===d.value,"future-day-row":a>d.value,"exam-day-row":a===g.value}])},[t("div",{class:w(["day-label",{"past-day-header":a<d.value,"today-header":a===d.value,"future-day-header":a>d.value,"exam-day-header":a===g.value}])},[ue(l(e)+" ",1),a<d.value?(u(),c("span",gs,l(s.$t("schedule.dayPassed")),1)):a===d.value?(u(),c("span",ms,l(s.$t("schedule.dayToday")),1)):C("",!0)],2),(u(),c(j,null,A(B,(i,n)=>t("div",{key:`${a}-${n}`,class:w(["schedule-cell",{"past-day":a<d.value,today:a===d.value,"future-day":a>d.value,"exam-day":a===g.value,"selected-slot":y.value&&a>=d.value&&a<g.value&&!K.value}]),onDrop:m=>{a>=d.value&&a<g.value&&Q(a,n)},onDragover:re(m=>{a>=d.value&&a<g.value&&ee(m)},["prevent"]),onClick:m=>{a>=d.value&&a<g.value&&I(a,n,m)}},[b.value[a]&&b.value[a][n]?(u(),c("div",{key:0,class:w(["scheduled-card",{locked:a<d.value||a===g.value}]),style:P({backgroundColor:b.value[a][n].color}),onClick:m=>a>=d.value&&a<g.value&&x(a,n),title:a===g.value?"è€ƒè©¦æ—¥ç„¡æ³•ç·¨è¼¯":a<d.value?"å·²éŽçš„å¤©æ•¸ç„¡æ³•ç·¨è¼¯":"é»žæ“Šç§»é™¤"},l(b.value[a][n].name),15,fs)):(u(),c("div",{key:1,class:w(["empty-slot",{locked:a<d.value||a===g.value}])},l(a===g.value?"ðŸ“":"ï¼‹"),3))],42,_s)),64))],2))),128))])])]),t("div",ps,[r.value.length>0&&r.value.some(e=>!_[e.id])?(u(),c("button",{key:0,onClick:se,class:"btn btn-primary"},l(s.$t("schedule.startSimulation")),1)):C("",!0)])]))}},bs=le(ys,[["__scopeId","data-v-a3f09c5e"]]);export{bs as default};
