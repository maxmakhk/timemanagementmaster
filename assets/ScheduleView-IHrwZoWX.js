import{_ as te,u as ae,r as S,f as le,h as ne,c as o,a as s,t as n,b,F as w,i as O,j as A,k as P,e as ie,o as c,n as N,l as E,m as oe,p as ce}from"./index-BO_G86Ar.js";import{a as re}from"./activities-D1PaX-zk.js";const ue={class:"schedule-view"},de={class:"schedule-header-bar"},ve={class:"header-title"},he={class:"header-subtitle"},me={key:0,class:"header-info"},ge={class:"deadline"},_e={class:"schedule-graphic-area"},fe={class:"graphic-placeholder"},ye={class:"schedule-container"},pe={class:"left-panels"},De={class:"npc-panel"},be={class:"panel-header"},Ce={key:0,class:"empty-state"},ke={key:1,class:"npc-cards-list"},Se=["onClick"],Ne={key:0,class:"pass-badge"},we={class:"npc-header"},Oe={class:"npc-image"},Pe={class:"npc-title"},je={class:"npc-description"},$e={class:"npc-goals"},Ae={class:"goal-row"},Ee={class:"goal-name"},qe={class:"goal-progress"},Je={class:"current-bar"},Le={class:"goal-values"},Me={class:"goal-row"},Qe={class:"goal-name"},Re={class:"goal-progress"},Ve={class:"current-bar"},Be={class:"goal-values"},Ke={class:"goal-row"},Te={class:"goal-name"},ze={class:"goal-progress"},Fe={class:"current-bar"},Ge={class:"goal-values"},Ue={class:"npc-status"},He={class:"status-item"},We={class:"status-item"},Xe={class:"npc-reward"},Ye={class:"cards-panel"},Ze={class:"cards-hint"},Ie={class:"cards-list"},xe=["onDragstart","onClick"],es={class:"card-name"},ss={class:"card-effect"},ts={key:1},as={key:2},ls={key:0,class:"card-cost"},ns={key:0},is={key:1},os={class:"timetable-panel"},cs={class:"timetable-header-info"},rs={class:"timetable-subtitle"},us={class:"timetable"},ds={class:"timetable-header"},vs={key:0,class:"day-status"},hs={key:1,class:"day-status"},ms={class:"time-label"},gs=["onDrop","onClick"],_s=["onClick","title"],fs={class:"action-buttons"},ys={__name:"ScheduleView",setup(ps){const J=ie(),{t:z}=ae(),r=S([]),C=S(r.value.length>0?r.value[0].id:null),q=S(0),y=A({}),m=A({}),j=S([]),g=A({}),M=P(()=>{if(!d.value)return[];const u=g[d.value.id]||d.value.requiredDays||5,e=u+1;return Array.from({length:e},(i,a)=>{const l=a+1;return l===u+1?`ðŸ“ Exam Day ${l}`:`Day ${l}`})}),Q=["08:00","10:00","12:00","14:00","16:00","18:00"],F=P(()=>re.map(t=>({...t,name:z(`schedule.${t.activityKey}`)}))),_=A({}),v=A({}),k=P(()=>{if(!d.value)return[];const u=g[d.value.id]||d.value.requiredDays||5;return _[C.value]||Array.from({length:u+1},()=>Array(6).fill(null))}),d=P(()=>r.value.find(t=>t.id===C.value)),G=P(()=>d.value&&(g[d.value.id]||d.value.requiredDays)||5),h=P(()=>d.value&&y[d.value.id]||0),$=S(null),p=S(null),L=S(!1),U=t=>{$.value=t},H=t=>{p.value?.id===t.id?p.value=null:p.value=t},W=t=>{C.value=t.id},R=(t,u,e=!1)=>{if(!d.value){alert("Please select or add an NPC mission first!"),$.value=null;return}if(t<h.value){alert("å·²éŽçš„å¤©æ•¸ç„¡æ³•ç·¨è¼¯"),$.value=null;return}const i=$.value||p.value;if(i){if(e){const a=k.value.length;for(let l=t;l<a;l++){const f={...i,instanceId:Date.now()+l};k.value[l][u]=f}}else{const a={...i,instanceId:Date.now()};k.value[t][u]=a}$.value=null}},X=(t,u,e)=>{if(p.value){const i=e?.shiftKey||!1;if(i&&e.preventDefault(),R(t,u,i),i){const a=k.value.length-t;console.log(`å·²å°‡ ${p.value.name} æ‡‰ç”¨åˆ° ${a} å¤©çš„ ${Q[u]} æ™‚æ®µ`)}}},Y=(t,u)=>{if(t<h.value){alert("å·²éŽçš„å¤©æ•¸ç„¡æ³•ç·¨è¼¯");return}k.value[t][u]=null},Z=t=>{t.preventDefault()},V=t=>{t.key==="Shift"&&(L.value=!0)},B=t=>{t.key==="Shift"&&(L.value=!1)};le(()=>{window.addEventListener("keydown",V),window.addEventListener("keyup",B);const t=sessionStorage.getItem("newNPC");if(t){const a=JSON.parse(t);sessionStorage.removeItem("newNPC");const l=sessionStorage.getItem("scheduleState");if(l){const D=JSON.parse(l);r.value=D.selectedNPCs||[],Object.assign(_,D.npcSchedules||{}),Object.assign(v,D.npcCurrentAbilities||{}),Object.assign(y,D.npcCurrentDays||{}),Object.assign(m,D.npcPassStatus||{}),j.value=D.completedQuestIds||[],D.extendedDays&&Object.assign(g,D.extendedDays)}r.value.push(a);const f=(a.requiredDays||5)+1;_[a.id]=Array.from({length:f},()=>Array(6).fill(null)),v[a.id]={coding:a.initial.coding,math:a.initial.math,fitness:a.initial.fitness,mood:50,energy:50},y[a.id]=0,m[a.id]=!1,C.value=a.id;return}const u=sessionStorage.getItem("scheduleState");if(u){const a=JSON.parse(u);r.value=a.selectedNPCs||[],Object.assign(_,a.npcSchedules||{}),Object.assign(v,a.npcCurrentAbilities||{}),Object.assign(y,a.npcCurrentDays||{}),Object.assign(m,a.npcPassStatus||{}),j.value=a.completedQuestIds||[],a.extendedDays&&Object.assign(g,a.extendedDays),r.value.length>0&&!C.value&&(C.value=r.value[0].id);return}const e=sessionStorage.getItem("selectedNPCs");if(e){r.value=JSON.parse(e),r.value.length>0&&(C.value=r.value[0].id);const a=Math.max(...r.value.map(l=>l.requiredDays||5));r.value.forEach(l=>{_[l.id]=Array.from({length:a},()=>Array(6).fill(null)),v[l.id]={coding:l.initial.coding,math:l.initial.math,fitness:l.initial.fitness,mood:50,energy:50},y[l.id]=0,m[l.id]=!1});return}const i=sessionStorage.getItem("simulationData");if(i){const a=JSON.parse(i);q.value=a.currentDay||0,Object.assign(_,a.npcSchedules),Object.assign(v,a.npcCurrentAbilities),a.npcCurrentDays&&Object.assign(y,a.npcCurrentDays),a.npcPassStatus&&Object.assign(m,a.npcPassStatus),a.extendedDays&&(Object.assign(g,a.extendedDays),r.value.forEach(l=>{const f=a.extendedDays[l.id];if(f&&_[l.id]){const D=f+1,K=_[l.id].length;if(K<D)for(let T=K;T<D;T++)_[l.id].push(Array(6).fill(null))}}))}}),ne(()=>{window.removeEventListener("keydown",V),window.removeEventListener("keyup",B)});const I=()=>{if(r.value.length===0){alert("è«‹å…ˆé¸æ“‡è‡³å°‘ä¸€å€‹ NPC");return}const t={selectedNPCs:r.value,npcSchedules:_,npcCurrentAbilities:v,npcCurrentDays:y,npcPassStatus:m,completedQuestIds:j.value,extendedDays:Object.keys(g).length>0?g:void 0};sessionStorage.setItem("scheduleState",JSON.stringify(t));const u={selectedNPCs:r.value.map(e=>({id:e.id,name:e.name,image:e.image,goals:e.goals,initial:e.initial,requiredDays:e.requiredDays})),npcSchedules:_,npcCurrentAbilities:v,npcCurrentDays:y,npcPassStatus:m,currentDay:q.value,extendedDays:Object.keys(g).length>0?g:void 0};sessionStorage.setItem("simulationData",JSON.stringify(u)),J.push("/time-management/simulation")},x=()=>{J.push("/")},ee=()=>{const t={selectedNPCs:r.value,npcSchedules:_,npcCurrentAbilities:v,npcCurrentDays:y,npcPassStatus:m,completedQuestIds:j.value,extendedDays:Object.keys(g).length>0?g:void 0};sessionStorage.setItem("scheduleState",JSON.stringify(t)),J.push("/time-management/intake")},se=()=>{r.value.length>0&&!confirm("Start a new game? This will clear all current missions and progress.")||(sessionStorage.removeItem("scheduleState"),sessionStorage.removeItem("simulationData"),sessionStorage.removeItem("selectedNPCs"),sessionStorage.removeItem("newNPC"),r.value=[],C.value=null,q.value=0,j.value=[],Object.keys(_).forEach(t=>delete _[t]),Object.keys(v).forEach(t=>delete v[t]),Object.keys(y).forEach(t=>delete y[t]),Object.keys(m).forEach(t=>delete m[t]),Object.keys(g).forEach(t=>delete g[t]))};return(t,u)=>(c(),o("div",ue,[s("div",de,[s("div",ve,[s("strong",null,n(t.$t("schedule.title")),1),s("span",he,n(t.$t("schedule.subtitle")),1)]),d.value?(c(),o("div",me,[s("span",null,n(d.value.name),1),s("span",ge,"æˆªæ­¢: ç¬¬ "+n(G.value)+" å¤© | é€²åº¦: ç¬¬ "+n(q.value+1)+" å¤©",1)])):b("",!0)]),s("div",_e,[s("div",fe,[s("span",null,n(d.value?.image),1),s("p",null,n(d.value?.name)+" - "+n(d.value?.character),1)])]),s("div",ye,[s("div",pe,[s("div",De,[s("div",be,[s("h2",null,"ðŸ“‹ "+n(t.$t("schedule.npcMissions")),1),s("button",{onClick:ee,class:"btn-add-mission"}," âž• Add NPC Mission ")]),r.value.length===0?(c(),o("div",Ce,[...u[1]||(u[1]=[s("p",null,"No missions yet!",-1),s("p",null,'Click "Add NPC Mission" to start',-1)])])):(c(),o("div",ke,[(c(!0),o(w,null,O(r.value,e=>(c(),o("div",{key:e.id,class:N(["npc-mission-card",{active:C.value===e.id,passed:m[e.id]}]),onClick:i=>!m[e.id]&&W(e)},[m[e.id]?(c(),o("div",Ne,"âœ… PASSED")):b("",!0),s("div",we,[s("span",Oe,n(e.image),1),s("div",Pe,[s("h3",null,n(e.name),1),s("span",{class:N(["difficulty","difficulty-"+e.difficulty.toLowerCase()])},n(e.difficulty),3)])]),s("p",je,n(e.description),1),s("div",$e,[s("div",Ae,[s("span",Ee,n(t.$t("schedule.coding")),1),s("div",qe,[s("span",Je,[s("span",{class:"current-fill",style:E({width:v[e.id].coding/e.goals.coding*100+"%"})},null,4)]),s("span",Le,n(v[e.id].coding)+" / "+n(e.goals.coding),1)])]),s("div",Me,[s("span",Qe,n(t.$t("schedule.math")),1),s("div",Re,[s("span",Ve,[s("span",{class:"current-fill",style:E({width:v[e.id].math/e.goals.math*100+"%"})},null,4)]),s("span",Be,n(v[e.id].math)+" / "+n(e.goals.math),1)])]),s("div",Ke,[s("span",Te,n(t.$t("schedule.fitness")),1),s("div",ze,[s("span",Fe,[s("span",{class:"current-fill",style:E({width:v[e.id].fitness/e.goals.fitness*100+"%"})},null,4)]),s("span",Ge,n(v[e.id].fitness)+" / "+n(e.goals.fitness),1)])])]),s("div",Ue,[s("span",He,"âš¡ ç²¾åŠ›: "+n(v[e.id].energy)+"/100",1),s("span",We,"ðŸ˜Š å¿ƒæƒ…: "+n(v[e.id].mood)+"/100",1)]),s("div",Xe," ðŸ’° +"+n(e.rewards.masterReputation)+" "+n(t.$t("schedule.reputation")),1)],10,Se))),128))]))]),s("div",Ye,[s("h2",null,n(t.$t("schedule.availableActivities")),1),s("p",Ze,n(p.value?p.value.name+" | é»žæ“Šæ·»åŠ  | Shift+é»žæ“Š æ‡‰ç”¨åˆ°æ‰€æœ‰å¤©æ•¸":"é»žæ“Šé¸æ“‡ æˆ– æ‹–æ‹½æ·»åŠ "),1),s("div",Ie,[(c(!0),o(w,null,O(F.value,e=>(c(),o("div",{key:e.id,class:N(["card",{selected:p.value?.id===e.id}]),style:E({backgroundColor:e.color,opacity:p.value?.id===e.id?1:.8}),draggable:"true",onDragstart:i=>U(e),onClick:i=>H(e)},[s("div",es,n(e.name),1),s("div",ss,[t.key!=="energy"&&t.key!=="mood"?(c(!0),o(w,{key:0},O(e.effect,(i,a)=>(c(),o("span",{key:a},n(a)+": +"+n(i),1))),128)):b("",!0),e.effect.energy&&!e.isRest?(c(),o("span",ts,"ðŸ’¾ èƒ½é‡+"+n(e.effect.energy),1)):b("",!0),e.effect.mood&&!e.isRest?(c(),o("span",as,"ðŸ˜Š å¿ƒæƒ…+"+n(e.effect.mood),1)):b("",!0)]),e.cost?(c(),o("div",ls,[e.cost.energy?(c(),o("span",ns,"âš¡ -"+n(e.cost.energy),1)):b("",!0),e.cost.mood?(c(),o("span",is,"ðŸ˜Š -"+n(e.cost.mood),1)):b("",!0)])):b("",!0)],46,xe))),128))])])]),s("div",os,[s("div",cs,[s("h2",null,n(t.$t("schedule.fiveDaySchedule"))+" - "+n(d.value?.name),1),s("p",rs,n(d.value?.description),1)]),s("div",us,[s("div",ds,[u[2]||(u[2]=s("div",{class:"time-col"},null,-1)),(c(!0),o(w,null,O(M.value,(e,i)=>(c(),o("div",{key:e,class:N(["day-col",{"past-day-header":i<h.value,"today-header":i===h.value,"future-day-header":i>h.value}])},[oe(n(e)+" ",1),i<h.value?(c(),o("span",vs,"âœ“ å·²éŽ")):i===h.value?(c(),o("span",hs,"ðŸ“ ä»Šå¤©")):b("",!0)],2))),128))]),(c(),o(w,null,O(Q,(e,i)=>s("div",{key:i,class:"timetable-row"},[s("div",ms,n(e),1),(c(!0),o(w,null,O(M.value,(a,l)=>(c(),o("div",{key:`${l}-${i}`,class:N(["schedule-cell",{"past-day":l<h.value,today:l===h.value,"future-day":l>h.value,"selected-slot":p.value&&l>=h.value&&!L.value}]),onDrop:f=>R(l,i),onDragover:u[0]||(u[0]=ce(f=>Z(f),["prevent"])),onClick:f=>X(l,i,f)},[k.value[l]&&k.value[l][i]?(c(),o("div",{key:0,class:N(["scheduled-card",{locked:l<h.value}]),style:E({backgroundColor:k.value[l][i].color}),onClick:f=>l>=h.value&&Y(l,i),title:l<h.value?"å·²éŽçš„å¤©æ•¸ç„¡æ³•ç·¨è¼¯":"é»žæ“Šç§»é™¤"},n(k.value[l][i].name),15,_s)):(c(),o("div",{key:1,class:N(["empty-slot",{locked:l<h.value}])},"ï¼‹",2))],42,gs))),128))])),64))])])]),s("div",fs,[s("button",{onClick:x,class:"btn btn-secondary"}," ðŸ  Home "),s("button",{onClick:se,class:"btn btn-danger"}," ðŸ”„ New Game "),r.value.length>0&&r.value.some(e=>!m[e.id])?(c(),o("button",{key:0,onClick:I,class:"btn btn-primary"},n(t.$t("schedule.startSimulation")),1)):b("",!0)])]))}},Cs=te(ys,[["__scopeId","data-v-f0e59479"]]);export{Cs as default};
