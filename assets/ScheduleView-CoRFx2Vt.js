import{_ as ae,u as le,r as $,f as ie,h as ne,c as o,a as t,b as C,n as O,t as l,F as j,i as A,j as M,k as N,e as oe,o as c,l as w,m as ce,p as ue}from"./index--HfBwbgo.js";import{a as re}from"./activities-D1PaX-zk.js";const de={class:"schedule-view"},ve={class:"graphic-placeholder"},he=["src"],ge={class:"schedule-header-bar"},me={class:"header-title"},_e={class:"header-subtitle"},fe={key:0,class:"header-info"},pe={class:"deadline"},ye={class:"schedule-container"},De={class:"left-panels"},Ce={class:"npc-panel"},ke={class:"panel-header"},be={key:0,class:"empty-state"},Se={key:1,class:"npc-cards-list"},Ne=["onClick"],we={key:0,class:"pass-badge"},$e={class:"npc-header"},Pe={class:"npc-image"},Oe={class:"npc-title"},je={class:"npc-description"},Ae={class:"npc-goals"},Ee={class:"goal-row"},Me={class:"goal-name"},qe={class:"goal-progress"},Le={class:"current-bar"},Je={class:"goal-values"},Te={class:"goal-row"},Be={class:"goal-name"},Ke={class:"goal-progress"},Qe={class:"current-bar"},Re={class:"goal-values"},Ve={class:"goal-row"},Fe={class:"goal-name"},ze={class:"goal-progress"},Ue={class:"current-bar"},Ge={class:"goal-values"},He={class:"npc-status"},We={class:"status-item"},Xe={class:"status-item"},Ye={class:"npc-reward"},Ze={class:"cards-panel"},Ie={class:"cards-hint"},xe={class:"cards-list"},es=["onDragstart","onClick"],ss={class:"card-name"},ts={class:"card-effect"},as={key:1},ls={key:2},is={key:0,class:"card-cost"},ns={key:0},os={key:1},cs={class:"timetable-panel"},us={class:"timetable-header-info"},rs={class:"timetable-subtitle"},ds={class:"timetable"},vs={class:"timetable-header"},hs={key:0,class:"day-status"},gs={key:1,class:"day-status"},ms=["onDrop","onDragover","onClick"],_s=["onClick","title"],fs={class:"action-buttons"},ps={__name:"ScheduleView",setup(ys){const L=oe(),{t:P}=le(),r=$([]),S=$(r.value.length>0?r.value[0].id:null),J=$(0),k=M({}),_=M({}),q=$([]),f=M({}),z=N(()=>{if(!v.value)return[];const u=f[v.value.id]||v.value.requiredDays||5,e=u+1;return Array.from({length:e},(a,i)=>{const n=i+1;return n===u+1?`ðŸ“ Exam Day ${n}`:`Day ${n}`})}),T=["08:00","10:00","12:00","14:00","16:00","18:00"],U=N(()=>re.map(s=>({...s,name:P(`schedule.${s.activityKey}`)}))),p=M({}),h=M({}),b=N(()=>{if(!v.value)return[];const u=f[v.value.id]||v.value.requiredDays||5;return p[S.value]||Array.from({length:u+1},()=>Array(6).fill(null))}),v=N(()=>r.value.find(s=>s.id===S.value)),g=N(()=>v.value&&(f[v.value.id]||v.value.requiredDays)||5),d=N(()=>v.value&&k[v.value.id]||0),G=N(()=>{if(!v.value)return"/images/time-management/Alice_rest.png";const s=["codingClass","mathStudy","fitnessTraining","lunch","rest"],u=v.value.name,e=s[Math.floor(Math.random()*s.length)];return`/images/time-management/${u}_${e}.png`}),H=N(()=>{const s=["bg_codingClass.jpg","bg_mathStudy.jpg","bg_fitnessTraining.jpg","bg_lunch.jpg","bg_rest.jpg"];return`/images/time-management/${s[Math.floor(Math.random()*s.length)]}`}),E=$(null),y=$(null),B=$(!1),W=s=>{E.value=s},X=s=>{y.value?.id===s.id?y.value=null:y.value=s},Y=s=>{S.value=s.id},K=(s,u,e=!1)=>{if(!v.value){alert(P("schedule.selectNPCFirst")),E.value=null;return}if(s<d.value){alert(P("schedule.pastDaysNoEdit")),E.value=null;return}const a=E.value||y.value;if(a){if(e){const i=b.value.length;for(let n=s;n<i;n++){const m={...a,instanceId:Date.now()+n};b.value[n][u]=m}}else{const i={...a,instanceId:Date.now()};b.value[s][u]=i}E.value=null}},Z=(s,u,e)=>{if(y.value){const a=e?.shiftKey||!1;if(a&&e.preventDefault(),K(s,u,a),a){const i=b.value.length-s;console.log(P("schedule.appliedToMultipleDays",{card:y.value.name,count:i,timeSlot:T[u]}))}}},I=(s,u)=>{if(s<d.value){alert(P("schedule.pastDaysNoEdit"));return}b.value[s][u]=null},x=s=>{s.preventDefault()},Q=s=>{s.key==="Shift"&&(B.value=!0)},R=s=>{s.key==="Shift"&&(B.value=!1)};ie(()=>{window.addEventListener("keydown",Q),window.addEventListener("keyup",R);const s=sessionStorage.getItem("newNPC");if(s){const i=JSON.parse(s);sessionStorage.removeItem("newNPC");const n=sessionStorage.getItem("scheduleState");if(n){const D=JSON.parse(n);r.value=D.selectedNPCs||[],Object.assign(p,D.npcSchedules||{}),Object.assign(h,D.npcCurrentAbilities||{}),Object.assign(k,D.npcCurrentDays||{}),Object.assign(_,D.npcPassStatus||{}),q.value=D.completedQuestIds||[],D.extendedDays&&Object.assign(f,D.extendedDays)}r.value.push(i);const m=(i.requiredDays||5)+1;p[i.id]=Array.from({length:m},()=>Array(6).fill(null)),h[i.id]={coding:i.initial.coding,math:i.initial.math,fitness:i.initial.fitness,mood:50,energy:50},k[i.id]=0,_[i.id]=!1,S.value=i.id;return}const u=sessionStorage.getItem("scheduleState");if(u){const i=JSON.parse(u);r.value=i.selectedNPCs||[],Object.assign(p,i.npcSchedules||{}),Object.assign(h,i.npcCurrentAbilities||{}),Object.assign(k,i.npcCurrentDays||{}),Object.assign(_,i.npcPassStatus||{}),q.value=i.completedQuestIds||[],i.extendedDays&&Object.assign(f,i.extendedDays),r.value.length>0&&!S.value&&(S.value=r.value[0].id);return}const e=sessionStorage.getItem("selectedNPCs");if(e){r.value=JSON.parse(e),r.value.length>0&&(S.value=r.value[0].id);const i=Math.max(...r.value.map(n=>n.requiredDays||5));r.value.forEach(n=>{p[n.id]=Array.from({length:i},()=>Array(6).fill(null)),h[n.id]={coding:n.initial.coding,math:n.initial.math,fitness:n.initial.fitness,mood:50,energy:50},k[n.id]=0,_[n.id]=!1});return}const a=sessionStorage.getItem("simulationData");if(a){const i=JSON.parse(a);J.value=i.currentDay||0,Object.assign(p,i.npcSchedules),Object.assign(h,i.npcCurrentAbilities),i.npcCurrentDays&&Object.assign(k,i.npcCurrentDays),i.npcPassStatus&&Object.assign(_,i.npcPassStatus),i.extendedDays&&(Object.assign(f,i.extendedDays),r.value.forEach(n=>{const m=i.extendedDays[n.id];if(m&&p[n.id]){const D=m+1,V=p[n.id].length;if(V<D)for(let F=V;F<D;F++)p[n.id].push(Array(6).fill(null))}}))}}),ne(()=>{window.removeEventListener("keydown",Q),window.removeEventListener("keyup",R)});const ee=()=>{if(r.value.length===0){alert(P("schedule.selectAtLeastOneNPC"));return}const s={selectedNPCs:r.value,npcSchedules:p,npcCurrentAbilities:h,npcCurrentDays:k,npcPassStatus:_,completedQuestIds:q.value,extendedDays:Object.keys(f).length>0?f:void 0};sessionStorage.setItem("scheduleState",JSON.stringify(s));const u={selectedNPCs:r.value.map(e=>({id:e.id,name:e.name,image:e.image,goals:e.goals,initial:e.initial,requiredDays:e.requiredDays})),npcSchedules:p,npcCurrentAbilities:h,npcCurrentDays:k,npcPassStatus:_,currentDay:J.value,extendedDays:Object.keys(f).length>0?f:void 0};sessionStorage.setItem("simulationData",JSON.stringify(u)),L.push("/time-management/simulation")},se=()=>{L.push("/")},te=()=>{const s={selectedNPCs:r.value,npcSchedules:p,npcCurrentAbilities:h,npcCurrentDays:k,npcPassStatus:_,completedQuestIds:q.value,extendedDays:Object.keys(f).length>0?f:void 0};sessionStorage.setItem("scheduleState",JSON.stringify(s)),L.push("/time-management/intake")};return(s,u)=>(c(),o("div",de,[t("button",{onClick:se,class:"home-button"},"ðŸ "),t("div",{class:"schedule-graphic-area",style:O({backgroundImage:`url(${H.value})`})},[t("div",ve,[v.value?(c(),o("img",{key:0,src:G.value,class:"random-character",alt:"Character"},null,8,he)):C("",!0)])],4),t("div",ge,[t("div",me,[t("strong",null,l(s.$t("schedule.title")),1),t("span",_e,l(s.$t("schedule.subtitle")),1)]),v.value?(c(),o("div",fe,[t("span",null,l(v.value.name)+" - "+l(s.$t(v.value.characterKey)),1),t("span",pe,l(s.$t("schedule.deadline"))+": "+l(s.$t("schedule.day"))+" "+l(g.value)+" | "+l(s.$t("schedule.progress"))+": "+l(s.$t("schedule.day"))+" "+l(J.value+1),1)])):C("",!0)]),t("div",ye,[t("div",De,[t("div",Ce,[t("div",ke,[t("h2",null,"ðŸ“‹ "+l(s.$t("schedule.npcMissions")),1),t("button",{onClick:te,class:"btn-add-mission"}," âž• Add NPC Mission ")]),r.value.length===0?(c(),o("div",be,[...u[0]||(u[0]=[t("p",null,"No missions yet!",-1),t("p",null,'Click "Add NPC Mission" to start',-1)])])):(c(),o("div",Se,[(c(!0),o(j,null,A(r.value,e=>(c(),o("div",{key:e.id,class:w(["npc-mission-card",{active:S.value===e.id,passed:_[e.id]}]),onClick:a=>!_[e.id]&&Y(e)},[_[e.id]?(c(),o("div",we,"âœ… PASSED")):C("",!0),t("div",$e,[t("span",Pe,l(e.image),1),t("div",Oe,[t("h3",null,l(e.name),1),t("span",{class:w(["difficulty","difficulty-"+e.difficulty.toLowerCase()])},l(e.difficulty),3)])]),t("p",je,l(s.$t(e.descriptionKey)),1),t("div",Ae,[t("div",Ee,[t("span",Me,l(s.$t("schedule.coding")),1),t("div",qe,[t("span",Le,[t("span",{class:"current-fill",style:O({width:h[e.id].coding/e.goals.coding*100+"%"})},null,4)]),t("span",Je,l(h[e.id].coding)+" / "+l(e.goals.coding),1)])]),t("div",Te,[t("span",Be,l(s.$t("schedule.math")),1),t("div",Ke,[t("span",Qe,[t("span",{class:"current-fill",style:O({width:h[e.id].math/e.goals.math*100+"%"})},null,4)]),t("span",Re,l(h[e.id].math)+" / "+l(e.goals.math),1)])]),t("div",Ve,[t("span",Fe,l(s.$t("schedule.fitness")),1),t("div",ze,[t("span",Ue,[t("span",{class:"current-fill",style:O({width:h[e.id].fitness/e.goals.fitness*100+"%"})},null,4)]),t("span",Ge,l(h[e.id].fitness)+" / "+l(e.goals.fitness),1)])])]),t("div",He,[t("span",We,"âš¡ ç²¾åŠ›: "+l(h[e.id].energy)+"/100",1),t("span",Xe,"ðŸ˜Š å¿ƒæƒ…: "+l(h[e.id].mood)+"/100",1)]),t("div",Ye," ðŸ’° +"+l(e.rewards.masterReputation)+" "+l(s.$t("schedule.reputation")),1)],10,Ne))),128))]))]),t("div",Ze,[t("p",Ie,l(y.value?`${y.value.name} | ${s.$t("schedule.clickToAdd")} | ${s.$t("schedule.shiftClickApplyAll")}`:s.$t("schedule.clickSelectOrDrag")),1),t("div",xe,[(c(!0),o(j,null,A(U.value,e=>(c(),o("div",{key:e.id,class:w(["card",{selected:y.value?.id===e.id}]),style:O({backgroundColor:e.color,opacity:y.value?.id===e.id?1:.8}),draggable:"true",onDragstart:a=>W(e),onClick:a=>X(e)},[t("div",ss,l(e.name),1),t("div",ts,[s.key!=="energy"&&s.key!=="mood"?(c(!0),o(j,{key:0},A(e.effect,(a,i)=>(c(),o("span",{key:i},l(i)+": +"+l(a),1))),128)):C("",!0),e.effect.energy&&!e.isRest?(c(),o("span",as,"ðŸ’¾ èƒ½é‡+"+l(e.effect.energy),1)):C("",!0),e.effect.mood&&!e.isRest?(c(),o("span",ls,"ðŸ˜Š å¿ƒæƒ…+"+l(e.effect.mood),1)):C("",!0)]),e.cost?(c(),o("div",is,[e.cost.energy?(c(),o("span",ns,"âš¡ -"+l(e.cost.energy),1)):C("",!0),e.cost.mood?(c(),o("span",os,"ðŸ˜Š -"+l(e.cost.mood),1)):C("",!0)])):C("",!0)],46,es))),128))])])]),t("div",cs,[t("div",us,[t("h2",null,l(s.$t("schedule.fiveDaySchedule"))+" - "+l(v.value?.name),1),t("p",rs,l(v.value?.description),1)]),t("div",ds,[t("div",vs,[u[1]||(u[1]=t("div",{class:"day-col"},null,-1)),(c(),o(j,null,A(T,(e,a)=>t("div",{key:a,class:"time-col"},l(e),1)),64))]),(c(!0),o(j,null,A(z.value,(e,a)=>(c(),o("div",{key:e,class:w(["timetable-row",{"past-day-row":a<d.value,"today-row":a===d.value,"future-day-row":a>d.value,"exam-day-row":a===g.value}])},[t("div",{class:w(["day-label",{"past-day-header":a<d.value,"today-header":a===d.value,"future-day-header":a>d.value,"exam-day-header":a===g.value}])},[ce(l(e)+" ",1),a<d.value?(c(),o("span",hs,l(s.$t("schedule.dayPassed")),1)):a===d.value?(c(),o("span",gs,l(s.$t("schedule.dayToday")),1)):C("",!0)],2),(c(),o(j,null,A(T,(i,n)=>t("div",{key:`${a}-${n}`,class:w(["schedule-cell",{"past-day":a<d.value,today:a===d.value,"future-day":a>d.value,"exam-day":a===g.value,"selected-slot":y.value&&a>=d.value&&a<g.value&&!B.value}]),onDrop:m=>{a>=d.value&&a<g.value&&K(a,n)},onDragover:ue(m=>{a>=d.value&&a<g.value&&x(m)},["prevent"]),onClick:m=>{a>=d.value&&a<g.value&&Z(a,n,m)}},[b.value[a]&&b.value[a][n]?(c(),o("div",{key:0,class:w(["scheduled-card",{locked:a<d.value||a===g.value}]),style:O({backgroundColor:b.value[a][n].color}),onClick:m=>a>=d.value&&a<g.value&&I(a,n),title:a===g.value?"è€ƒè©¦æ—¥ç„¡æ³•ç·¨è¼¯":a<d.value?"å·²éŽçš„å¤©æ•¸ç„¡æ³•ç·¨è¼¯":"é»žæ“Šç§»é™¤"},l(b.value[a][n].name),15,_s)):(c(),o("div",{key:1,class:w(["empty-slot",{locked:a<d.value||a===g.value}])},l(a===g.value?"ðŸ“":"ï¼‹"),3))],42,ms)),64))],2))),128))])])]),t("div",fs,[r.value.length>0&&r.value.some(e=>!_[e.id])?(c(),o("button",{key:0,onClick:ee,class:"btn btn-primary"},l(s.$t("schedule.startSimulation")),1)):C("",!0)])]))}},ks=ae(ps,[["__scopeId","data-v-24536412"]]);export{ks as default};
