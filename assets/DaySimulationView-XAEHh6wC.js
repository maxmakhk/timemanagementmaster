import{_ as oe,u as de,x as re,f as ce,c as m,a as t,b as E,n as b,t as d,F as z,i as H,m as ve,r as _,k as h,e as ye,o as p,l as me}from"./index-BJxI1--x.js";import{g as he}from"./activities-D1PaX-zk.js";const pe={class:"day-simulation-view"},ge={class:"header-content"},fe=["src"],_e={class:"header-info"},Ce={key:0},De={key:1,class:"simulation-status"},$e={key:2,class:"simulation-status"},be={class:"progress-bar"},xe={key:0,class:"simulation-container"},we={class:"npc-tabs"},Re=["onClick"],Se={class:"status-bar"},Pe={class:"status-item energy-bar"},Ne={class:"status-label"},Me={class:"bar"},Ae={class:"status-value"},Ie={class:"status-item mood-bar"},ke={class:"status-label"},Ee={class:"bar"},qe={class:"status-value"},Te={class:"combined-content"},Fe={class:"log-section"},je={class:"abilities-section"},Be={class:"abilities-grid"},Qe={class:"ability-card"},Ge={class:"ability-name"},Je={class:"ability-bar"},Oe={class:"ability-value"},Ve={class:"ability-card"},Ke={class:"ability-name"},Le={class:"ability-bar"},ze={class:"ability-value"},He={class:"ability-card"},Ue={class:"ability-name"},We={class:"ability-bar"},Xe={class:"ability-value"},Ye={class:"ability-card"},Ze={class:"ability-name"},ea={class:"ability-bar"},aa={class:"ability-value"},sa={class:"ability-card"},ta={class:"ability-name"},la={class:"ability-bar"},na={class:"ability-value"},ua={class:"action-buttons"},ia={key:1,class:"simulation-message"},q=1e3,oa={__name:"DaySimulationView",setup(da){const T=ye(),{t:l}=de(),a=_(null),x=_(0),G=_(0),g=_({}),M=_(null),w=_(""),R=_(null),k=_(!1),U=_(0),F=_(!1),J=h(()=>a.value?a.value.extendedDays&&a.value.extendedDays[o.value?.id]?a.value.extendedDays[o.value.id]:Math.max(...a.value.selectedNPCs.map(e=>e.requiredDays||5)):5),o=h(()=>a.value?a.value.selectedNPCs[G.value]:null),v=h(()=>!a.value||!M.value?o.value:a.value.selectedNPCs.find(e=>e.id===M.value)||o.value),c=h(()=>!a.value||!v.value?null:a.value.npcCurrentAbilities[v.value.id]||{}),W=h(()=>!a.value||!v.value?J.value:a.value.extendedDays?.[v.value.id]||v.value.requiredDays||J.value),X=h(()=>{const e=v.value?.name||o.value?.name||"",s=x.value+1,n=W.value,u=w.value||"",i=u?`Day ${s} ${u}`:`Day ${s}`;return`${l("day.title")} - ${i} / ${n} ${l("day.days")} (${e})`}),Y=h(()=>!R.value||!R.value.bgImage?"/images/time-management/bg_rest.jpg":R.value.bgImage),O=h(()=>{if(!v.value)return null;const e=v.value.name;return!R.value||!R.value.activityKey?`/images/time-management/${e}_rest.png`:`/images/time-management/${e}_${R.value.activityKey}.png`}),V=h(()=>v.value?g.value[v.value.id]||[]:[]),j=_(null),Z=()=>{j.value&&setTimeout(()=>{j.value.scrollTop=j.value.scrollHeight},100)};re(()=>V.value.length,()=>{Z()});const ee=h(()=>!a.value||!o.value?null:a.value.npcCurrentAbilities[o.value.id]||{});ce(()=>{const e=sessionStorage.getItem("simulationData");e?(a.value=JSON.parse(e),a.value.npcCurrentDays||(a.value.npcCurrentDays={},a.value.selectedNPCs.forEach(s=>{a.value.npcCurrentDays[s.id]=0})),x.value=a.value.npcCurrentDays[a.value.selectedNPCs[0].id]||0,a.value.selectedNPCs&&a.value.selectedNPCs.forEach(s=>{g.value[s.id]||(g.value[s.id]=[])}),o.value&&(M.value=o.value.id),le()):(alert(l("day.cannotLoadData")),T.push("/time-management/schedule"))});const S=e=>new Promise(s=>setTimeout(s,e)),ae=e=>({Á∑®Á®ãË™≤:"Coding Class","Coding Class":"Coding Class",Êï∏Â≠∏Â≠∏Áøí:"Math Study","Math Study":"Math Study",ÂÅ•Ë∫´Ë®ìÁ∑¥:"Fitness","Fitness Training":"Fitness",Fitness:"Fitness",‰ºëÊÅØ:"Rest",Rest:"Rest",ÂçàÈ§ê:"Lunch",Lunch:"Lunch"})[e]||e,se=async(e,s,n,u)=>{n.push(`‚è∞ ${s.time} - ${s.activity}`);const i=ae(s.activity),P=he(i);R.value=P||null;let N={coding:0,math:0,fitness:0};if(P?.isRest)u.energy=100,u.mood=100,n.push(`  ${l("day.energyRestored")}`),n.push(`  ${l("day.moodRestored")}`);else if(s.activity==="Lunch")u.energy=Math.min(u.energy+50,100),n.push(`  ${l("day.energyGained",{amount:50})}`);else{const $=P?.cost||{energy:30,mood:50},A=u.energy,C=u.mood;u.energy-=$.energy,u.mood-=$.mood,n.push(`  ${l("day.energyConsumed",{amount:$.energy,old:A,new:Math.max(u.energy,0)})}`),n.push(`  ${l("day.moodConsumed",{amount:$.mood,old:C,new:Math.max(u.mood,0)})}`);let D=1;if((u.energy<0||u.mood<0)&&(D=.5,n.push(`  ${l("day.lowEfficiency")}`)),s.effect.coding){const f=Math.floor(s.effect.coding*D);N.coding=f,n.push(`  ${l("day.codingGained",{amount:f})}`)}if(s.effect.math){const f=Math.floor(s.effect.math*D);N.math=f,n.push(`  ${l("day.mathGained",{amount:f})}`)}if(s.effect.fitness){const f=Math.floor(s.effect.fitness*D);N.fitness=f,n.push(`  ${l("day.fitnessGained",{amount:f})}`)}}return u.energy=Math.max(u.energy,0),u.mood=Math.max(u.mood,0),N},te=async(e,s)=>{M.value=e.id,U.value=s,w.value=l("day.preparing");const n=a.value.npcCurrentDays?.[e.id]??0;g.value[e.id]||(g.value[e.id]=[]),g.value[e.id]=[];const u=a.value.npcCurrentAbilities[e.id];u.energy=100,u.mood=100;const i=g.value[e.id];i.push(l("day.daySchedule",{day:n+1,name:e.name})),i.push("---"),await S(500);const $=(a.value.npcSchedules[e.id]?.[n]||[]).map((r,y)=>r?{slotIndex:y,time:["08:00","10:00","12:00","14:00","16:00","18:00"][y],activity:r.name,effect:r.effect}:null).filter(r=>r!==null),A=e.requiredDays||5,D=a.value?.extendedDays?.[e.id]||A;if(n===D){i.push(l("day.examDay")),i.push("---"),w.value=l("day.examInProgress"),await S(q);const r=L();r&&(i.push(l("day.examResults")),i.push("---"),i.push(l("day.examAttempt",{attempt:r.examAttempt})),i.push("---"),i.push(l("day.skillAssessment")),r.skillResults.forEach(y=>{const B=y.passed?l("day.passed"):l("day.failed"),Q="‚ñà".repeat(Math.floor(y.percentage/10))+"‚ñë".repeat(10-Math.floor(y.percentage/10));i.push(`  ${y.emoji} ${y.name}: ${y.current}/${y.goal} (${y.percentage}%) ${B}`),i.push(`     ${Q}`)}),i.push("---"),i.push(l("day.overallPassRate",{passed:r.passedSkills})),r.passed?(i.push(l("day.examPassed")),i.push(l("day.reputationGained",{amount:r.finalReward})),i.push(l("day.questCompleted"))):(i.push(l("day.examFailed")),i.push(l("day.skillsBelowTarget",{count:3-r.passedSkills})),i.push(l("day.needMoreTime")),r.examAttempt>1&&i.push(l("day.rewardReduced",{original:r.originalReward,final:r.finalReward,percent:Math.round((1-r.finalReward/r.originalReward)*100)}))),i.push("---")),w.value=l("day.examComplete"),await S(q)}else if($.length===0)i.push(l("day.noSchedule")),w.value=l("day.noScheduleStatus"),await S(q);else{let r=0,y=0,B=0;for(const Q of $){w.value=Q.time;const I=await se(e,Q,i,u);r+=I.coding,y+=I.math,B+=I.fitness,u.coding+=I.coding,u.math+=I.math,u.fitness+=I.fitness,await S(q)}i.push("---"),i.push(l("day.dailySummary")),i.push(`  ${l("day.coding")}Ôºö${u.coding-r} ‚Üí ${u.coding}`),i.push(`  ${l("day.math")}Ôºö${u.math-y} ‚Üí ${u.math}`),i.push(`  ${l("day.body")}Ôºö${u.fitness-B} ‚Üí ${u.fitness}`),i.push(`  ${l("day.energy")}Ôºö${u.energy}`),i.push(`  ${l("day.mood")}Ôºö${u.mood}`),await S(q),i.push(l("day.dayComplete")),w.value=l("day.complete")}a.value.npcCurrentDays[e.id]=n,await S(1500)},le=async()=>{if(!(!a.value||k.value)){k.value=!0,F.value=!1;for(let e=0;e<a.value.selectedNPCs.length;e++){const s=a.value.selectedNPCs[e];await te(s,e)}k.value=!1,F.value=!0}},K=h(()=>{if(!o.value)return!1;const e=o.value.requiredDays||5,n=a.value?.extendedDays?.[o.value.id]||e;return x.value===n}),L=()=>{if(!o.value)return console.error("currentNPC is null"),null;if(!o.value.goals)return console.error("currentNPC.goals is missing",o.value),null;const e=a.value.examAttempt||1,s=[{name:"Coding",emoji:"üìö",key:"coding",goal:o.value.goals.coding},{name:"Math",emoji:"üî¢",key:"math",goal:o.value.goals.math},{name:"Fitness",emoji:"üí™",key:"fitness",goal:o.value.goals.fitness}];let n=0;const u=s.map(C=>{const D=ee.value[C.key]||0,f=Math.round(D/C.goal*100),r=D>=C.goal;return r&&n++,{name:C.name,emoji:C.emoji,key:C.key,current:D,goal:C.goal,percentage:Math.min(f,100),passed:r}}),i=n===3,P=o.value?.rewards?.masterReputation||10,N=Math.pow(.75,e-1),$=Math.round(P*N),A={skillResults:u,passedSkills:n,passed:i,originalReward:P,finalReward:$,requiredDays:o.value?.requiredDays||5,examAttempt:e,currentNPC:o.value,questIndex:G.value};return console.log("Exam results calculated:",A),A},ne=()=>{const e=L();if(!e||!o.value){g.value[o.value?.id]||(g.value[o.value.id]=[]),g.value[o.value.id].push(l("day.cannotCalculateExam"));return}const s=g.value[o.value.id];return s.push("---"),s.push(l("day.examResults")),s.push("---"),s.push(l("day.examAttempt",{attempt:e.examAttempt})),s.push("---"),s.push(l("day.skillAssessment")),e.skillResults.forEach(n=>{const u=n.passed?l("day.passed"):l("day.failed");s.push(`  ${n.emoji} ${n.name}: ${n.current}/${n.goal} (${n.percentage}%) ${u}`),s.push(`     ${bar}`)}),s.push("---"),s.push(l("day.overallPassRate",{passed:e.passedSkills})),e.passed?(s.push(l("day.examPassed")),s.push(l("day.reputationGained",{amount:e.finalReward})),s.push(l("day.questCompleted")),a.value.completedQuests=a.value.completedQuests||[],a.value.completedQuests.push({id:o.value.id,reward:e.finalReward,passed:!0})):(s.push(l("day.examFailed")),s.push(l("day.skillsBelowTarget",{count:3-e.passedSkills})),s.push(l("day.needMoreTime")),e.examAttempt>1&&s.push(l("day.rewardReduced",{original:e.originalReward,final:e.finalReward,percent:Math.round((1-e.finalReward/e.originalReward)*100)}))),s.push("---"),e},ue=()=>{if(console.log("completeDay called, currentDay:",x.value,"isExamDay:",K.value),K.value){const e=ne();if(e&&e.passed){a.value.npcCurrentDays||(a.value.npcCurrentDays={}),a.value.npcPassStatus||(a.value.npcPassStatus={}),a.value.npcCurrentDays[o.value.id]=-1,a.value.npcPassStatus[o.value.id]=!0;const s={selectedNPCs:a.value.selectedNPCs,npcSchedules:a.value.npcSchedules,npcCurrentAbilities:a.value.npcCurrentAbilities,npcCurrentDays:a.value.npcCurrentDays,npcPassStatus:a.value.npcPassStatus,completedQuestIds:a.value.completedQuestIds||[],extendedDays:a.value.extendedDays};s.completedQuestIds.includes(o.value.id)||s.completedQuestIds.push(o.value.id),sessionStorage.setItem("scheduleState",JSON.stringify(s)),sessionStorage.setItem("simulationData",JSON.stringify(a.value)),T.push("/time-management/schedule")}else if(e){const s=o.value.requiredDays,n=o.value.id;a.value.npcCurrentDays||(a.value.npcCurrentDays={}),a.value.npcCurrentDays[n]=s+1,a.value.examAttempt=(a.value.examAttempt||1)+1,a.value.extendedDays=a.value.extendedDays||{},a.value.extendedDays[n]=s+1+5,sessionStorage.setItem("simulationData",JSON.stringify(a.value)),T.push("/time-management/schedule")}}else a.value.npcCurrentDays||(a.value.npcCurrentDays={}),a.value.selectedNPCs.forEach(e=>{a.value.npcCurrentDays[e.id]!==-1&&(a.value.npcCurrentDays[e.id]=(a.value.npcCurrentDays[e.id]||0)+1)}),x.value++,a.value.currentDay=x.value,sessionStorage.setItem("simulationData",JSON.stringify(a.value)),T.push("/time-management/schedule")},ie=h(()=>{const e=a.value?.selectedNPCs.length||1,s=J.value*e;return(x.value*e+G.value+1)/s*100});return(e,s)=>(p(),m("div",pe,[t("header",{class:"simulation-header",style:b({backgroundImage:`url(${Y.value})`})},[s[0]||(s[0]=t("div",{class:"header-overlay"},null,-1)),t("div",ge,[O.value?(p(),m("img",{key:0,src:O.value,class:"header-character",alt:"Character"},null,8,fe)):E("",!0)])],4),t("div",_e,[v.value||o.value?(p(),m("strong",Ce,d(X.value),1)):E("",!0),k.value?(p(),m("div",De,[s[1]||(s[1]=t("span",{class:"status-indicator running"},"‚è≥",-1)),t("span",null,d(e.$t("day.simulationRunning")),1)])):F.value?(p(),m("div",$e,[s[2]||(s[2]=t("span",{class:"status-indicator complete"},"‚úÖ",-1)),t("span",null,d(e.$t("day.simulationComplete")),1)])):E("",!0),t("div",be,[t("div",{class:"progress",style:b({width:ie.value+"%"})},null,4)])]),a.value?(p(),m("div",xe,[t("div",we,[(p(!0),m(z,null,H(a.value.selectedNPCs,n=>(p(),m("button",{key:n.id,class:me(["npc-tab",{active:M.value===n.id}]),onClick:u=>M.value=n.id},d(n.image)+" "+d(n.name),11,Re))),128))]),t("div",Se,[t("div",Pe,[t("span",Ne,"‚ö° "+d(e.$t("day.energy")),1),t("div",Me,[t("div",{class:"fill",style:b({width:c.value?.energy||"0%",backgroundColor:c.value?.energy>50?"#2ecc71":c.value?.energy>25?"#f39c12":"#e74c3c"})},null,4)]),t("span",Ae,d(c.value?.energy||0)+"/100",1)]),t("div",Ie,[t("span",ke,"üòä "+d(e.$t("day.mood")),1),t("div",Ee,[t("div",{class:"fill",style:b({width:c.value?.mood||"0%",backgroundColor:c.value?.mood>50?"#3498db":c.value?.mood>25?"#f39c12":"#e74c3c"})},null,4)]),t("span",qe,d(c.value?.mood||0)+"/100",1)])]),t("div",Te,[t("div",Fe,[t("h2",null,"üìù "+d(e.$t("day.eventLog")),1),t("div",{ref_key:"logContainer",ref:j,class:"log-container"},[(p(!0),m(z,null,H(V.value,(n,u)=>(p(),m("div",{key:u,class:"log-entry"},d(n),1))),128))],512)]),t("div",je,[t("h2",null,"üìä "+d(v.value?.name)+" "+d(e.$t("day.currentAbilities")),1),t("div",Be,[t("div",Qe,[t("div",Ge,"üìö "+d(e.$t("day.coding")),1),t("div",Je,[t("div",{class:"ability-fill",style:b({width:c.value?.coding/100*100+"%"})},null,4)]),t("div",Oe,d(c.value?.coding||0)+" / "+d(v.value?.goals?.coding||0),1)]),t("div",Ve,[t("div",Ke,"üî¢ "+d(e.$t("day.math")),1),t("div",Le,[t("div",{class:"ability-fill",style:b({width:c.value?.math/100*100+"%"})},null,4)]),t("div",ze,d(c.value?.math||0)+" / "+d(v.value?.goals?.math||0),1)]),t("div",He,[t("div",Ue,"üí™ "+d(e.$t("day.body")),1),t("div",We,[t("div",{class:"ability-fill",style:b({width:c.value?.fitness/100*100+"%"})},null,4)]),t("div",Xe,d(c.value?.fitness||0)+" / "+d(v.value?.goals?.fitness||0),1)]),t("div",Ye,[t("div",Ze,"üòä "+d(e.$t("day.mood")),1),t("div",ea,[t("div",{class:"ability-fill",style:b({width:(c.value?.mood||0)+"%"})},null,4)]),t("div",aa,d(c.value?.mood||0)+"/100",1)]),t("div",sa,[t("div",ta,"‚ö° "+d(e.$t("day.energy")),1),t("div",la,[t("div",{class:"ability-fill",style:b({width:(c.value?.energy||0)+"%"})},null,4)]),t("div",na,d(c.value?.energy||0)+"/100",1)])])])])])):E("",!0),t("div",ua,[F.value?(p(),m("button",{key:0,onClick:ue,class:"btn btn-primary"},d(e.$t("day.completeDay")),1)):k.value?(p(),m("div",ia,[s[3]||(s[3]=t("span",{class:"spinner"},null,-1)),ve(" "+d(e.$t("day.simulatingAllStudents")),1)])):E("",!0)])]))}},va=oe(oa,[["__scopeId","data-v-1ab5beea"]]);export{va as default};
