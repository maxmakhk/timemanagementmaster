import{_ as de,u as re,x as ce,f as ve,c as m,a as t,b as E,n as x,t as d,F as H,i as U,m as ye,r as _,k as h,e as me,o as p,l as he}from"./index-mYd7Dziu.js";import{g as pe}from"./activities-C17TaqRo.js";const ge={class:"day-simulation-view"},fe={class:"header-content"},_e=["src"],Ce={class:"header-info"},De={key:0},$e={key:1,class:"simulation-status"},be={key:2,class:"simulation-status"},xe={class:"progress-bar"},we={key:0,class:"simulation-container"},Pe={class:"npc-tabs"},Re=["onClick"],Se={class:"status-bar"},Ne={class:"status-item energy-bar"},Me={class:"status-label"},Ie={class:"bar"},Ae={class:"status-value"},ke={class:"status-item mood-bar"},Ee={class:"status-label"},qe={class:"bar"},Te={class:"status-value"},Fe={class:"combined-content"},je={class:"log-section"},Be={class:"abilities-section"},Qe={class:"abilities-grid"},Ge={class:"ability-card"},Je={class:"ability-name"},Oe={class:"ability-bar"},Ve={class:"ability-value"},Ke={class:"ability-card"},Le={class:"ability-name"},ze={class:"ability-bar"},He={class:"ability-value"},Ue={class:"ability-card"},We={class:"ability-name"},Xe={class:"ability-bar"},Ye={class:"ability-value"},Ze={class:"ability-card"},ea={class:"ability-name"},aa={class:"ability-bar"},sa={class:"ability-value"},ta={class:"ability-card"},la={class:"ability-name"},na={class:"ability-bar"},ua={class:"ability-value"},ia={class:"action-buttons"},oa={key:1,class:"simulation-message"},q=1e3,da={__name:"DaySimulationView",setup(ra){const T="/timemanagementmaster/",F=me(),{t:l}=re(),a=_(null),w=_(0),J=_(0),g=_({}),M=_(null),P=_(""),$=_(null),k=_(!1),W=_(0),j=_(!1),O=h(()=>a.value?a.value.extendedDays&&a.value.extendedDays[o.value?.id]?a.value.extendedDays[o.value.id]:Math.max(...a.value.selectedNPCs.map(e=>e.requiredDays||5)):5),o=h(()=>a.value?a.value.selectedNPCs[J.value]:null),v=h(()=>!a.value||!M.value?o.value:a.value.selectedNPCs.find(e=>e.id===M.value)||o.value),c=h(()=>!a.value||!v.value?null:a.value.npcCurrentAbilities[v.value.id]||{}),X=h(()=>!a.value||!v.value?O.value:a.value.extendedDays?.[v.value.id]||v.value.requiredDays||O.value),Y=h(()=>{const e=v.value?.name||o.value?.name||"",s=w.value+1,n=X.value,u=P.value||"",i=u?`Day ${s} ${u}`:`Day ${s}`;return`${l("day.title")} - ${i} / ${n} ${l("day.days")} (${e})`}),Z=h(()=>{if(!$.value||!$.value.bgImage)return T+"images/time-management/bg_rest.jpg";const e=$.value.bgImage.startsWith("/")?$.value.bgImage.substring(1):$.value.bgImage;return T+e}),V=h(()=>{if(!v.value)return null;const e=v.value.name;return!$.value||!$.value.activityKey?T+`images/time-management/${e}_rest.png`:T+`images/time-management/${e}_${$.value.activityKey}.png`}),K=h(()=>v.value?g.value[v.value.id]||[]:[]),B=_(null),ee=()=>{B.value&&setTimeout(()=>{B.value.scrollTop=B.value.scrollHeight},100)};ce(()=>K.value.length,()=>{ee()});const ae=h(()=>!a.value||!o.value?null:a.value.npcCurrentAbilities[o.value.id]||{});ve(()=>{const e=sessionStorage.getItem("simulationData");e?(a.value=JSON.parse(e),a.value.npcCurrentDays||(a.value.npcCurrentDays={},a.value.selectedNPCs.forEach(s=>{a.value.npcCurrentDays[s.id]=0})),w.value=a.value.npcCurrentDays[a.value.selectedNPCs[0].id]||0,a.value.selectedNPCs&&a.value.selectedNPCs.forEach(s=>{g.value[s.id]||(g.value[s.id]=[])}),o.value&&(M.value=o.value.id),ne()):(alert(l("day.cannotLoadData")),F.push("/time-management/schedule"))});const R=e=>new Promise(s=>setTimeout(s,e)),se=e=>({Á∑®Á®ãË™≤:"Coding Class","Coding Class":"Coding Class",Êï∏Â≠∏Â≠∏Áøí:"Math Study","Math Study":"Math Study",ÂÅ•Ë∫´Ë®ìÁ∑¥:"Fitness","Fitness Training":"Fitness",Fitness:"Fitness",‰ºëÊÅØ:"Rest",Rest:"Rest",ÂçàÈ§ê:"Lunch",Lunch:"Lunch"})[e]||e,te=async(e,s,n,u)=>{n.push(`‚è∞ ${s.time} - ${s.activity}`);const i=se(s.activity),S=pe(i);$.value=S||null;let N={coding:0,math:0,fitness:0};if(S?.isRest)u.energy=100,u.mood=100,n.push(`  ${l("day.energyRestored")}`),n.push(`  ${l("day.moodRestored")}`);else if(s.activity==="Lunch")u.energy=Math.min(u.energy+50,100),n.push(`  ${l("day.energyGained",{amount:50})}`);else{const b=S?.cost||{energy:30,mood:50},I=u.energy,C=u.mood;u.energy-=b.energy,u.mood-=b.mood,n.push(`  ${l("day.energyConsumed",{amount:b.energy,old:I,new:Math.max(u.energy,0)})}`),n.push(`  ${l("day.moodConsumed",{amount:b.mood,old:C,new:Math.max(u.mood,0)})}`);let D=1;if((u.energy<0||u.mood<0)&&(D=.5,n.push(`  ${l("day.lowEfficiency")}`)),s.effect.coding){const f=Math.floor(s.effect.coding*D);N.coding=f,n.push(`  ${l("day.codingGained",{amount:f})}`)}if(s.effect.math){const f=Math.floor(s.effect.math*D);N.math=f,n.push(`  ${l("day.mathGained",{amount:f})}`)}if(s.effect.fitness){const f=Math.floor(s.effect.fitness*D);N.fitness=f,n.push(`  ${l("day.fitnessGained",{amount:f})}`)}}return u.energy=Math.max(u.energy,0),u.mood=Math.max(u.mood,0),N},le=async(e,s)=>{M.value=e.id,W.value=s,P.value=l("day.preparing");const n=a.value.npcCurrentDays?.[e.id]??0;g.value[e.id]||(g.value[e.id]=[]),g.value[e.id]=[];const u=a.value.npcCurrentAbilities[e.id];u.energy=100,u.mood=100;const i=g.value[e.id];i.push(l("day.daySchedule",{day:n+1,name:e.name})),i.push("---"),await R(500);const b=(a.value.npcSchedules[e.id]?.[n]||[]).map((r,y)=>r?{slotIndex:y,time:["08:00","10:00","12:00","14:00","16:00","18:00"][y],activity:r.name,effect:r.effect}:null).filter(r=>r!==null),I=e.requiredDays||5,D=a.value?.extendedDays?.[e.id]||I;if(n===D){i.push(l("day.examDay")),i.push("---"),P.value=l("day.examInProgress"),await R(q);const r=z();r&&(i.push(l("day.examResults")),i.push("---"),i.push(l("day.examAttempt",{attempt:r.examAttempt})),i.push("---"),i.push(l("day.skillAssessment")),r.skillResults.forEach(y=>{const Q=y.passed?l("day.passed"):l("day.failed"),G="‚ñà".repeat(Math.floor(y.percentage/10))+"‚ñë".repeat(10-Math.floor(y.percentage/10));i.push(`  ${y.emoji} ${y.name}: ${y.current}/${y.goal} (${y.percentage}%) ${Q}`),i.push(`     ${G}`)}),i.push("---"),i.push(l("day.overallPassRate",{passed:r.passedSkills})),r.passed?(i.push(l("day.examPassed")),i.push(l("day.reputationGained",{amount:r.finalReward})),i.push(l("day.questCompleted"))):(i.push(l("day.examFailed")),i.push(l("day.skillsBelowTarget",{count:3-r.passedSkills})),i.push(l("day.needMoreTime")),r.examAttempt>1&&i.push(l("day.rewardReduced",{original:r.originalReward,final:r.finalReward,percent:Math.round((1-r.finalReward/r.originalReward)*100)}))),i.push("---")),P.value=l("day.examComplete"),await R(q)}else if(b.length===0)i.push(l("day.noSchedule")),P.value=l("day.noScheduleStatus"),await R(q);else{let r=0,y=0,Q=0;for(const G of b){P.value=G.time;const A=await te(e,G,i,u);r+=A.coding,y+=A.math,Q+=A.fitness,u.coding+=A.coding,u.math+=A.math,u.fitness+=A.fitness,await R(q)}i.push("---"),i.push(l("day.dailySummary")),i.push(`  ${l("day.coding")}Ôºö${u.coding-r} ‚Üí ${u.coding}`),i.push(`  ${l("day.math")}Ôºö${u.math-y} ‚Üí ${u.math}`),i.push(`  ${l("day.body")}Ôºö${u.fitness-Q} ‚Üí ${u.fitness}`),i.push(`  ${l("day.energy")}Ôºö${u.energy}`),i.push(`  ${l("day.mood")}Ôºö${u.mood}`),await R(q),i.push(l("day.dayComplete")),P.value=l("day.complete")}a.value.npcCurrentDays[e.id]=n,await R(1500)},ne=async()=>{if(!(!a.value||k.value)){k.value=!0,j.value=!1;for(let e=0;e<a.value.selectedNPCs.length;e++){const s=a.value.selectedNPCs[e];await le(s,e)}k.value=!1,j.value=!0}},L=h(()=>{if(!o.value)return!1;const e=o.value.requiredDays||5,n=a.value?.extendedDays?.[o.value.id]||e;return w.value===n}),z=()=>{if(!o.value)return console.error("currentNPC is null"),null;if(!o.value.goals)return console.error("currentNPC.goals is missing",o.value),null;const e=a.value.examAttempt||1,s=[{name:"Coding",emoji:"üìö",key:"coding",goal:o.value.goals.coding},{name:"Math",emoji:"üî¢",key:"math",goal:o.value.goals.math},{name:"Fitness",emoji:"üí™",key:"fitness",goal:o.value.goals.fitness}];let n=0;const u=s.map(C=>{const D=ae.value[C.key]||0,f=Math.round(D/C.goal*100),r=D>=C.goal;return r&&n++,{name:C.name,emoji:C.emoji,key:C.key,current:D,goal:C.goal,percentage:Math.min(f,100),passed:r}}),i=n===3,S=o.value?.rewards?.masterReputation||10,N=Math.pow(.75,e-1),b=Math.round(S*N),I={skillResults:u,passedSkills:n,passed:i,originalReward:S,finalReward:b,requiredDays:o.value?.requiredDays||5,examAttempt:e,currentNPC:o.value,questIndex:J.value};return console.log("Exam results calculated:",I),I},ue=()=>{const e=z();if(!e||!o.value){g.value[o.value?.id]||(g.value[o.value.id]=[]),g.value[o.value.id].push(l("day.cannotCalculateExam"));return}const s=g.value[o.value.id];return s.push("---"),s.push(l("day.examResults")),s.push("---"),s.push(l("day.examAttempt",{attempt:e.examAttempt})),s.push("---"),s.push(l("day.skillAssessment")),e.skillResults.forEach(n=>{const u=n.passed?l("day.passed"):l("day.failed");s.push(`  ${n.emoji} ${n.name}: ${n.current}/${n.goal} (${n.percentage}%) ${u}`),s.push(`     ${bar}`)}),s.push("---"),s.push(l("day.overallPassRate",{passed:e.passedSkills})),e.passed?(s.push(l("day.examPassed")),s.push(l("day.reputationGained",{amount:e.finalReward})),s.push(l("day.questCompleted")),a.value.completedQuests=a.value.completedQuests||[],a.value.completedQuests.push({id:o.value.id,reward:e.finalReward,passed:!0})):(s.push(l("day.examFailed")),s.push(l("day.skillsBelowTarget",{count:3-e.passedSkills})),s.push(l("day.needMoreTime")),e.examAttempt>1&&s.push(l("day.rewardReduced",{original:e.originalReward,final:e.finalReward,percent:Math.round((1-e.finalReward/e.originalReward)*100)}))),s.push("---"),e},ie=()=>{if(console.log("completeDay called, currentDay:",w.value,"isExamDay:",L.value),L.value){const e=ue();if(e&&e.passed){a.value.npcCurrentDays||(a.value.npcCurrentDays={}),a.value.npcPassStatus||(a.value.npcPassStatus={}),a.value.npcCurrentDays[o.value.id]=-1,a.value.npcPassStatus[o.value.id]=!0;const s={selectedNPCs:a.value.selectedNPCs,npcSchedules:a.value.npcSchedules,npcCurrentAbilities:a.value.npcCurrentAbilities,npcCurrentDays:a.value.npcCurrentDays,npcPassStatus:a.value.npcPassStatus,completedQuestIds:a.value.completedQuestIds||[],extendedDays:a.value.extendedDays};s.completedQuestIds.includes(o.value.id)||s.completedQuestIds.push(o.value.id),sessionStorage.setItem("scheduleState",JSON.stringify(s)),sessionStorage.setItem("simulationData",JSON.stringify(a.value)),F.push("/time-management/schedule")}else if(e){const s=o.value.requiredDays,n=o.value.id;a.value.npcCurrentDays||(a.value.npcCurrentDays={}),a.value.npcCurrentDays[n]=s+1,a.value.examAttempt=(a.value.examAttempt||1)+1,a.value.extendedDays=a.value.extendedDays||{},a.value.extendedDays[n]=s+1+5,sessionStorage.setItem("simulationData",JSON.stringify(a.value)),F.push("/time-management/schedule")}}else a.value.npcCurrentDays||(a.value.npcCurrentDays={}),a.value.selectedNPCs.forEach(e=>{a.value.npcCurrentDays[e.id]!==-1&&(a.value.npcCurrentDays[e.id]=(a.value.npcCurrentDays[e.id]||0)+1)}),w.value++,a.value.currentDay=w.value,sessionStorage.setItem("simulationData",JSON.stringify(a.value)),F.push("/time-management/schedule")},oe=h(()=>{const e=a.value?.selectedNPCs.length||1,s=O.value*e;return(w.value*e+J.value+1)/s*100});return(e,s)=>(p(),m("div",ge,[t("header",{class:"simulation-header",style:x({backgroundImage:`url(${Z.value})`})},[s[0]||(s[0]=t("div",{class:"header-overlay"},null,-1)),t("div",fe,[V.value?(p(),m("img",{key:0,src:V.value,class:"header-character",alt:"Character"},null,8,_e)):E("",!0)])],4),t("div",Ce,[v.value||o.value?(p(),m("strong",De,d(Y.value),1)):E("",!0),k.value?(p(),m("div",$e,[s[1]||(s[1]=t("span",{class:"status-indicator running"},"‚è≥",-1)),t("span",null,d(e.$t("day.simulationRunning")),1)])):j.value?(p(),m("div",be,[s[2]||(s[2]=t("span",{class:"status-indicator complete"},"‚úÖ",-1)),t("span",null,d(e.$t("day.simulationComplete")),1)])):E("",!0),t("div",xe,[t("div",{class:"progress",style:x({width:oe.value+"%"})},null,4)])]),a.value?(p(),m("div",we,[t("div",Pe,[(p(!0),m(H,null,U(a.value.selectedNPCs,n=>(p(),m("button",{key:n.id,class:he(["npc-tab",{active:M.value===n.id}]),onClick:u=>M.value=n.id},d(n.image)+" "+d(n.name),11,Re))),128))]),t("div",Se,[t("div",Ne,[t("span",Me,"‚ö° "+d(e.$t("day.energy")),1),t("div",Ie,[t("div",{class:"fill",style:x({width:c.value?.energy||"0%",backgroundColor:c.value?.energy>50?"#2ecc71":c.value?.energy>25?"#f39c12":"#e74c3c"})},null,4)]),t("span",Ae,d(c.value?.energy||0)+"/100",1)]),t("div",ke,[t("span",Ee,"üòä "+d(e.$t("day.mood")),1),t("div",qe,[t("div",{class:"fill",style:x({width:c.value?.mood||"0%",backgroundColor:c.value?.mood>50?"#3498db":c.value?.mood>25?"#f39c12":"#e74c3c"})},null,4)]),t("span",Te,d(c.value?.mood||0)+"/100",1)])]),t("div",Fe,[t("div",je,[t("h2",null,"üìù "+d(e.$t("day.eventLog")),1),t("div",{ref_key:"logContainer",ref:B,class:"log-container"},[(p(!0),m(H,null,U(K.value,(n,u)=>(p(),m("div",{key:u,class:"log-entry"},d(n),1))),128))],512)]),t("div",Be,[t("h2",null,"üìä "+d(v.value?.name)+" "+d(e.$t("day.currentAbilities")),1),t("div",Qe,[t("div",Ge,[t("div",Je,"üìö "+d(e.$t("day.coding")),1),t("div",Oe,[t("div",{class:"ability-fill",style:x({width:c.value?.coding/100*100+"%"})},null,4)]),t("div",Ve,d(c.value?.coding||0)+" / "+d(v.value?.goals?.coding||0),1)]),t("div",Ke,[t("div",Le,"üî¢ "+d(e.$t("day.math")),1),t("div",ze,[t("div",{class:"ability-fill",style:x({width:c.value?.math/100*100+"%"})},null,4)]),t("div",He,d(c.value?.math||0)+" / "+d(v.value?.goals?.math||0),1)]),t("div",Ue,[t("div",We,"üí™ "+d(e.$t("day.body")),1),t("div",Xe,[t("div",{class:"ability-fill",style:x({width:c.value?.fitness/100*100+"%"})},null,4)]),t("div",Ye,d(c.value?.fitness||0)+" / "+d(v.value?.goals?.fitness||0),1)]),t("div",Ze,[t("div",ea,"üòä "+d(e.$t("day.mood")),1),t("div",aa,[t("div",{class:"ability-fill",style:x({width:(c.value?.mood||0)+"%"})},null,4)]),t("div",sa,d(c.value?.mood||0)+"/100",1)]),t("div",ta,[t("div",la,"‚ö° "+d(e.$t("day.energy")),1),t("div",na,[t("div",{class:"ability-fill",style:x({width:(c.value?.energy||0)+"%"})},null,4)]),t("div",ua,d(c.value?.energy||0)+"/100",1)])])])])])):E("",!0),t("div",ia,[j.value?(p(),m("button",{key:0,onClick:ie,class:"btn btn-primary"},d(e.$t("day.completeDay")),1)):k.value?(p(),m("div",oa,[s[3]||(s[3]=t("span",{class:"spinner"},null,-1)),ye(" "+d(e.$t("day.simulatingAllStudents")),1)])):E("",!0)])]))}},ya=de(da,[["__scopeId","data-v-4fae653c"]]);export{ya as default};
